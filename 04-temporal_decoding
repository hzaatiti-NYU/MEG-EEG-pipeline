#Multivariate Statistics (Decoding / MVPA) on MEG/EEG Data
%matplotlib qt
import pathlib
import matplotlib
import matplotlib.pyplot as plt
import mne

matplotlib.use('Qt5Agg')
mne.set_log_level('warning')
#Load epochs
epochs = mne.read_epochs(pathlib.Path('out_data') / 'epochs_epo.fif')
epochs.apply_baseline((None, 0))

#Calculate empirical evoked difference
evoked_diff = mne.combine_evoked(
    [epochs['eyes_closed'].average(),
     epochs['eyes_open'].average()],
    weights=[1, -1]  # Subtraction
)

evoked_diff.plot(gfp=True)
mne.viz.plot_compare_evokeds(
    [epochs['eyes_closed'].average(),
     epochs['eyes_open'].average(),
     evoked_diff]
)
# Equalize the number of epochs: To keep chance level at 50% accuracy, we first equalize the number of epochs in each condition.

epochs.equalize_event_counts(epochs.event_id)
